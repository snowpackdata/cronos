import{N as e,h as t,r as a,f as l,b as s,c as r,a as n,q as o,H as i,J as c,I as d,z as u,E as x,F as p,G as m,x as g,D as y,y as f,o as b,_ as v}from"./index-2uCPEpPG.js";import"./index-8V-xrl-L.js";import{_ as h}from"./StaffAvatar.vue_vue_type_script_setup_true_lang-ChSVjzSa.js";const _={getBills:async()=>e("bills")}.getBills,w={class:"px-4 sm:px-6 lg:px-8"},D={class:"mt-4 bg-white p-4 rounded-lg shadow border border-gray-200"},T={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},k={key:0,class:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow mt-6"},I={key:1,class:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow mt-6"},S={class:"text-gray-600 mb-2"},E={key:2,class:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow mt-6"},L={class:"text-gray-600 mb-4"},A={key:3,class:"mt-4 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg"},C={key:4,class:"mt-6 bg-white shadow overflow-hidden rounded-lg border border-gray-200"},F={class:"min-w-full divide-y divide-gray-300"},P={class:"divide-y divide-gray-200 bg-white"},B=["onClick"],$={class:"py-2 pl-3 pr-2 text-sm"},j={class:"py-2 px-2 text-sm"},U={class:"font-medium text-gray-900"},V={class:"text-xs text-gray-600"},O={class:"px-2 py-2 text-sm"},R={key:0,class:"flex items-center gap-2"},N={class:"text-gray-700"},Y={key:1,class:"text-gray-700"},H={class:"px-2 py-2 text-sm text-gray-700"},M={class:"px-2 py-2 text-sm font-medium text-gray-900"},q={class:"px-2 py-2 text-sm"},z={class:"flex items-center gap-2"},G={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-800"},W={key:0,class:"bg-gray-50"},Z={colspan:"6",class:"px-3 py-3"},J={class:"bg-white rounded-lg border border-gray-200 p-3"},Q={key:0,class:"mb-3 bg-red-50 border border-red-200 text-red-800 px-3 py-2 rounded text-sm"},K={class:"flex justify-between items-start mb-3"},X={class:"flex items-center gap-3"},ee=["href"],te={class:"flex gap-2"},ae=["onClick"],le=["onClick"],se=["onClick","disabled"],re=["onClick"],ne={class:"grid grid-cols-3 gap-4 mb-3 text-sm"},oe={class:"ml-2 text-gray-900"},ie={class:"ml-2 text-gray-900"},ce={key:0,class:"ml-2 text-xs font-bold text-red-700"},de={key:1},ue={class:"min-w-full text-sm"},xe={class:"divide-y divide-gray-200"},pe={class:"px-2 py-1.5 text-gray-700"},me={class:"px-2 py-1.5 text-gray-700"},ge={class:"px-2 py-1.5 text-right text-gray-700"},ye={class:"px-2 py-1.5 text-right text-gray-700"},fe={class:"px-2 py-1.5 text-right font-medium text-gray-900"},be={class:"px-2 py-1.5 text-gray-700"},ve={class:"px-2 py-1.5 text-right font-medium text-gray-900"},he={class:"bg-gray-50 font-semibold"},_e={class:"px-2 py-1.5 text-right text-gray-900"},we={key:2,class:"text-sm text-gray-500 italic"},De={key:5,class:"fixed inset-0 bg-gray-500/75 flex items-center justify-center z-50"},Te={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},ke={class:"px-6 py-4"},Ie={class:"text-xs text-gray-700 mb-4"},Se={class:"mb-4"},Ee=["max"],Le=v(t({__name:"AccountsPayableView",setup(e){const t=a([]),v=a(!0),Le=a(null),Ae=a(new Set),Ce=a(null),Fe=a({}),Pe=a(!1),Be=a(null),$e=a((new Date).toISOString().split("T")[0]),je=a({}),Ue=a("all"),Ve=a(""),Oe=a(""),Re=a("");l(async()=>{await Ne()});const Ne=async()=>{v.value=!0,Le.value=null;try{t.value=await _()}catch(e){console.error("Error fetching bills:",e),Le.value="Failed to load bills. Please try again."}finally{v.value=!1}},Ye=s(()=>{let e=t.value;if("all"!==Ue.value&&(e=e.filter(e=>e.state===Ue.value)),Ve.value){const t=new Date(Ve.value);e=e.filter(e=>{const a=qe(e);return a&&new Date(a)>=t})}if(Oe.value){const t=new Date(Oe.value);t.setHours(23,59,59,999),e=e.filter(e=>{const a=qe(e);return a&&new Date(a)<=t})}if(Re.value){const t=Re.value.toLowerCase();e=e.filter(e=>e.bill_number&&e.bill_number.toLowerCase().includes(t)||e.vendor_name&&e.vendor_name.toLowerCase().includes(t)||e.user&&`${e.user.first_name} ${e.user.last_name}`.toLowerCase().includes(t))}return e.sort((e,t)=>{const a=new Date(qe(e)||0);return new Date(qe(t)||0).getTime()-a.getTime()}),e}),He=e=>Ae.value.has(e),Me=e=>{if(!e)return"-";if(e.startsWith("00")||"0001-01-01T00:00:00Z"===e)return"-";const t=new Date(e);return`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`},qe=e=>e.date_paid?e.date_paid:e.accepted_at?e.accepted_at:e.period_start?e.period_start:e.date_created||"",ze=e=>{let t=(new Date).getFullYear();e.accepted_at?t=new Date(e.accepted_at).getFullYear():e.date_created&&(t=new Date(e.date_created).getFullYear());return`${t}${e.ID.toString().padStart(4,"0")}`},Ge=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100),We=e=>e.description?e.description:"Payroll",Ze=e=>{switch(e){case"BILL_STATE_DRAFT":default:return"bg-gray-100 text-gray-700";case"BILL_STATE_ACCEPTED":return"bg-blue-100 text-blue-700";case"BILL_STATE_PAID":return"bg-green-100 text-green-700";case"BILL_STATE_VOID":return"bg-red-100 text-red-700"}},Je=e=>{if("BILL_STATE_PAID"===e.state||"BILL_STATE_VOID"===e.state||"BILL_STATE_DRAFT"===e.state)return!1;const t=e.date_due;if(!t||t.startsWith("00")||"0001-01-01T00:00:00Z"===t)return!1;const a=new Date(t),l=new Date;return l.setHours(0,0,0,0),a<l},Qe=e=>{const t=e.date_due;if(!t||t.startsWith("00")||"0001-01-01T00:00:00Z"===t)return 0;const a=new Date(t),l=new Date;l.setHours(0,0,0,0);const s=l.getTime()-a.getTime();return Math.ceil(s/864e5)},Ke=e=>e.user?`${e.user.first_name} ${e.user.last_name}`:e.vendor_name||"N/A",Xe=()=>{Ue.value="all",Ve.value="",Oe.value="",Re.value=""},et=()=>{Pe.value=!1,Be.value=null},tt=async()=>{if(!Be.value)return;const e=Be.value;Fe.value[e.ID]=null;try{const t=localStorage.getItem("snowpack_token"),a=await fetch(`/api/bills/${e.ID}/paid`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":t||""},body:JSON.stringify({payment_date:$e.value})});if(!a.ok)throw new Error(`Failed to mark bill as paid: ${a.statusText}`);Ce.value=`Bill #${ze(e)} marked as paid on ${$e.value}`,Pe.value=!1,Be.value=null,await Ne(),setTimeout(()=>{Ce.value=null},3e3)}catch(t){console.error("Error marking bill as paid:",t),Fe.value[e.ID]=t instanceof Error?t.message:"Failed to mark bill as paid",Pe.value=!1}};return(e,a)=>(b(),r("div",w,[a[36]||(a[36]=n("div",{class:"sm:flex sm:items-center"},[n("div",{class:"sm:flex-auto"},[n("h1",{class:"text-xl font-semibold text-gray-900"},"Accounts Payable"),n("p",{class:"mt-2 text-sm text-gray-700"},"Track and manage payroll bills for employees and contractors.")])],-1)),n("div",D,[n("div",T,[n("div",null,[a[5]||(a[5]=n("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),i(n("input",{id:"search","onUpdate:modelValue":a[0]||(a[0]=e=>Re.value=e),type:"text",placeholder:"Bill # or Employee...",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[c,Re.value]])]),n("div",null,[a[7]||(a[7]=n("label",{for:"state",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),i(n("select",{id:"state","onUpdate:modelValue":a[1]||(a[1]=e=>Ue.value=e),class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},a[6]||(a[6]=[n("option",{value:"all"},"All",-1),n("option",{value:"BILL_STATE_DRAFT"},"Draft",-1),n("option",{value:"BILL_STATE_PAID"},"Paid",-1),n("option",{value:"BILL_STATE_VOID"},"Void",-1)]),512),[[d,Ue.value]])]),n("div",null,[a[8]||(a[8]=n("label",{for:"start-date",class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),i(n("input",{id:"start-date","onUpdate:modelValue":a[2]||(a[2]=e=>Ve.value=e),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[c,Ve.value]])]),n("div",null,[a[9]||(a[9]=n("label",{for:"end-date",class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),i(n("input",{id:"end-date","onUpdate:modelValue":a[3]||(a[3]=e=>Oe.value=e),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[c,Oe.value]])])]),n("div",{class:"mt-3 flex justify-end"},[n("button",{onClick:Xe,class:"text-sm text-gray-600 hover:text-gray-900"}," Clear Filters ")])]),v.value?(b(),r("div",k,a[10]||(a[10]=[n("i",{class:"fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"},null,-1),n("span",{class:"text-gray-600"},"Loading bills...",-1)]))):Le.value?(b(),r("div",I,[a[12]||(a[12]=n("i",{class:"fas fa-exclamation-circle text-4xl text-red-600 mb-4"},null,-1)),n("span",S,u(Le.value),1),n("button",{onClick:Ne,class:"btn-secondary mt-4"},a[11]||(a[11]=[n("i",{class:"fas fa-sync mr-2"},null,-1),x(" Retry ")]))])):0===Ye.value.length?(b(),r("div",E,[a[13]||(a[13]=n("i",{class:"fas fa-file-invoice text-5xl text-blue-600 mb-4"},null,-1)),a[14]||(a[14]=n("p",{class:"text-lg font-medium text-gray-700"},"No bills found",-1)),n("p",L,u(0===t.value.length?"Bills will appear here once they are created":"Try adjusting your filters"),1),t.value.length>0?(b(),r("button",{key:0,onClick:Xe,class:"btn-secondary"}," Clear Filters ")):o("",!0)])):o("",!0),Ce.value?(b(),r("div",A,[a[15]||(a[15]=n("i",{class:"fas fa-check-circle mr-2"},null,-1)),x(u(Ce.value),1)])):(b(),r("div",C,[n("table",F,[a[32]||(a[32]=n("thead",{class:"bg-gray-50"},[n("tr",null,[n("th",{scope:"col",class:"w-10 py-2 pl-3 pr-2 text-left text-sm font-semibold text-gray-900"}),n("th",{scope:"col",class:"py-2 px-2 text-left text-sm font-semibold text-gray-900"},"Bill"),n("th",{scope:"col",class:"px-2 py-2 text-left text-sm font-semibold text-gray-900"},"Employee"),n("th",{scope:"col",class:"px-2 py-2 text-left text-sm font-semibold text-gray-900"},"Date"),n("th",{scope:"col",class:"px-2 py-2 text-left text-sm font-semibold text-gray-900"},"Amount"),n("th",{scope:"col",class:"px-2 py-2 text-left text-sm font-semibold text-gray-900"},"Status")])],-1)),n("tbody",P,[(b(!0),r(p,null,m(Ye.value,e=>{return b(),r(p,{key:e.ID},[n("tr",{onClick:t=>{return a=e.ID,void(Ae.value.has(a)?Ae.value.delete(a):Ae.value.add(a));var a},class:"hover:bg-gray-50 cursor-pointer transition-colors"},[n("td",$,[n("i",{class:g([He(e.ID)?"fas fa-chevron-down":"fas fa-chevron-right","text-gray-400"])},null,2)]),n("td",j,[n("div",U,"#"+u(ze(e)),1),n("div",V,u(We(e)),1)]),n("td",O,[e.user?(b(),r("div",R,[y(h,{employee:e.user,size:"xs"},null,8,["employee"]),n("span",N,u(Ke(e)),1)])):(b(),r("span",Y,u(Ke(e)),1))]),n("td",H,u(Me(qe(e))),1),n("td",M,u(Ge(e.total_amount)),1),n("td",q,[n("div",z,[n("span",{class:g([Ze(e.state),"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"])},u((t=e.state,t?t.replace("BILL_STATE_","").replace(/_/g," "):"Unknown")),3),Je(e)?(b(),r("span",G,[a[16]||(a[16]=n("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),x(" "+u(Qe(e))+"d overdue ",1)])):o("",!0)])])],8,B),He(e.ID)?(b(),r("tr",W,[n("td",Z,[n("div",J,[Fe.value[e.ID]?(b(),r("div",Q,[a[17]||(a[17]=n("i",{class:"fas fa-exclamation-circle mr-2"},null,-1)),x(u(Fe.value[e.ID]),1)])):o("",!0),n("div",K,[n("div",X,[a[19]||(a[19]=n("h4",{class:"text-sm font-semibold text-gray-900"},"Bill Details",-1)),e.file?(b(),r("a",{key:0,href:e.file,target:"_blank",class:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1"},a[18]||(a[18]=[n("i",{class:"fas fa-file-pdf"},null,-1),x(" View PDF ")]),8,ee)):o("",!0)]),n("div",te,["BILL_STATE_DRAFT"===e.state?(b(),r("button",{key:0,onClick:f(t=>(async e=>{Fe.value[e.ID]=null;try{const t=localStorage.getItem("snowpack_token"),a=await fetch(`/api/bills/${e.ID}/accept`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":t||""}});if(!a.ok)throw new Error(`Failed to accept bill: ${a.statusText}`);Ce.value=`Bill #${ze(e)} accepted`,await Ne(),setTimeout(()=>{Ce.value=null},3e3)}catch(t){console.error("Error accepting bill:",t),Fe.value[e.ID]=t instanceof Error?t.message:"Failed to accept bill"}})(e),["stop"]),class:"px-3 py-1 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors"},a[20]||(a[20]=[n("i",{class:"fas fa-check-circle mr-1"},null,-1),x(" Accept ")]),8,ae)):o("",!0),"BILL_STATE_ACCEPTED"===e.state?(b(),r("button",{key:1,onClick:f(t=>(e=>{Be.value=e,$e.value=(new Date).toISOString().split("T")[0],Pe.value=!0})(e),["stop"]),class:"px-3 py-1 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded transition-colors"},a[21]||(a[21]=[n("i",{class:"fas fa-check mr-1"},null,-1),x(" Mark Paid ")]),8,le)):o("",!0),"BILL_STATE_ACCEPTED"===e.state?(b(),r("button",{key:2,onClick:f(t=>(async e=>{Fe.value[e.ID]=null,je.value[e.ID]=!0;try{const t=localStorage.getItem("snowpack_token"),a=await fetch(`/api/bills/${e.ID}/regenerate`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":t||""}});if(!a.ok)throw new Error(`Failed to regenerate PDF: ${a.statusText}`);Ce.value=`PDF regenerated for bill #${ze(e)}`,await Ne(),setTimeout(()=>{Ce.value=null},3e3)}catch(t){console.error("Error regenerating PDF:",t),Fe.value[e.ID]=t instanceof Error?t.message:"Failed to regenerate PDF"}finally{je.value[e.ID]=!1}})(e),["stop"]),disabled:je.value[e.ID],class:"px-3 py-1 text-xs font-medium text-white bg-purple-600 hover:bg-purple-700 rounded transition-colors disabled:opacity-50",title:"Regenerate bill PDF"},[n("i",{class:g(["fas",je.value[e.ID]?"fa-spinner fa-spin":"fa-file-pdf"])},null,2),x(" "+u(je.value[e.ID]?"Generating...":"Generate PDF"),1)],8,se)):o("",!0),"BILL_STATE_DRAFT"===e.state||"BILL_STATE_ACCEPTED"===e.state?(b(),r("button",{key:3,onClick:f(t=>(async e=>{if(confirm(`Are you sure you want to void bill #${ze(e)}? This action cannot be undone.`)){Fe.value[e.ID]=null;try{const t=localStorage.getItem("snowpack_token"),a=await fetch(`/api/bills/${e.ID}/void`,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":t||""}});if(!a.ok)throw new Error(`Failed to void bill: ${a.statusText}`);Ce.value=`Bill #${ze(e)} voided`,await Ne(),setTimeout(()=>{Ce.value=null},3e3)}catch(t){console.error("Error voiding bill:",t),Fe.value[e.ID]=t instanceof Error?t.message:"Failed to void bill"}}})(e),["stop"]),class:"px-3 py-1 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded transition-colors"},a[22]||(a[22]=[n("i",{class:"fas fa-times mr-1"},null,-1),x(" Void ")]),8,re)):o("",!0)])]),n("div",ne,[n("div",null,[a[23]||(a[23]=n("span",{class:"text-gray-600"},"Period:",-1)),n("span",oe,u(Me(e.period_start))+" - "+u(Me(e.period_end)),1)]),n("div",null,[a[24]||(a[24]=n("span",{class:"text-gray-600"},"Hours:",-1)),n("span",ie,u(e.total_hours.toFixed(2)),1)]),n("div",null,[a[25]||(a[25]=n("span",{class:"text-gray-600"},"Due Date:",-1)),n("span",{class:g(["ml-2",Je(e)?"text-red-700 font-bold":"text-gray-900"])},u(Me(e.date_due)),3),Je(e)?(b(),r("span",ce," ("+u(Qe(e))+" days overdue) ",1)):o("",!0)])]),e.line_items&&e.line_items.length>0||e.recurring_bill_line_items&&e.recurring_bill_line_items.length>0?(b(),r("div",de,[a[31]||(a[31]=n("h5",{class:"text-sm font-medium text-gray-900 mb-2"},"Line Items",-1)),n("table",ue,[a[30]||(a[30]=n("thead",{class:"bg-gray-100"},[n("tr",null,[n("th",{class:"px-2 py-1.5 text-left text-xs font-medium text-gray-600"},"Type"),n("th",{class:"px-2 py-1.5 text-left text-xs font-medium text-gray-600"},"Description"),n("th",{class:"px-2 py-1.5 text-right text-xs font-medium text-gray-600"},"Quantity"),n("th",{class:"px-2 py-1.5 text-right text-xs font-medium text-gray-600"},"Rate"),n("th",{class:"px-2 py-1.5 text-right text-xs font-medium text-gray-600"},"Amount")])],-1)),n("tbody",xe,[(b(!0),r(p,null,m(e.line_items,e=>{return b(),r("tr",{key:`line-${e.ID}`},[n("td",pe,u((t=e.type,t?t.replace("LINE_ITEM_TYPE_","").replace(/_/g," "):"Unknown")),1),n("td",me,u(e.description),1),n("td",ge,u(e.quantity>0?e.quantity.toFixed(2):"-"),1),n("td",ye,u(e.rate>0?Ge(100*e.rate):"-"),1),n("td",fe,u(Ge(e.amount)),1)]);var t}),128)),(b(!0),r(p,null,m(e.recurring_bill_line_items,e=>(b(),r("tr",{key:`recurring-${e.ID}`},[a[26]||(a[26]=n("td",{class:"px-2 py-1.5 text-gray-700"},"SALARY",-1)),n("td",be,u(e.description),1),a[27]||(a[27]=n("td",{class:"px-2 py-1.5 text-right text-gray-700"},"-",-1)),a[28]||(a[28]=n("td",{class:"px-2 py-1.5 text-right text-gray-700"},"-",-1)),n("td",ve,u(Ge(e.amount)),1)]))),128))]),n("tfoot",he,[n("tr",null,[a[29]||(a[29]=n("td",{colspan:"4",class:"px-2 py-1.5 text-right text-gray-900"},"Total",-1)),n("td",_e,u(Ge(e.total_amount)),1)])])])])):(b(),r("div",we," No line items available "))])])])):o("",!0)],64);var t}),128))])])])),Pe.value?(b(),r("div",De,[n("div",Te,[a[35]||(a[35]=n("div",{class:"bg-sage px-6 py-4 rounded-t-lg"},[n("h3",{class:"text-sm font-semibold text-white"},"Confirm Payment Date")],-1)),n("div",ke,[n("p",Ie," Enter the date the payment was made for Bill #"+u(Be.value?ze(Be.value):""),1),n("div",Se,[a[33]||(a[33]=n("label",{class:"block text-xs font-medium text-gray-700 mb-2"},"Payment Date",-1)),i(n("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>$e.value=e),type:"date",class:"w-full px-3 py-2 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sage focus:border-transparent",max:(new Date).toISOString().split("T")[0]},null,8,Ee),[[c,$e.value]])])]),n("div",{class:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end gap-3"},[n("button",{onClick:et,class:"px-4 py-2 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," Cancel "),n("button",{onClick:tt,class:"px-4 py-2 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors"},a[34]||(a[34]=[n("i",{class:"fas fa-check mr-2"},null,-1),x("Mark as Paid ")]))])])])):o("",!0)]))}}),[["__scopeId","data-v-4c90ab9d"]]);export{Le as default};
