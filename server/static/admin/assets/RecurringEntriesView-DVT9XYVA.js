import{h as e,r as t,b as a,f as s,c as l,a as r,q as n,E as i,x as o,z as d,F as c,G as u,D as x,H as p,I as y,J as g,y as m,o as v}from"./index-2uCPEpPG.js";import{a as f}from"./index-8V-xrl-L.js";import{f as b}from"./staff-BJndFo0_.js";import{_ as w}from"./StaffAvatar.vue_vue_type_script_setup_true_lang-ChSVjzSa.js";async function h(e,t){return(await f.put(`/api/admin/recurring-entries/${e}`,t)).data}const _={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},k={class:"mb-4 flex items-center justify-between"},S={class:"flex gap-2"},C=["disabled"],D=["disabled"],F={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4"},I={class:"bg-white rounded-lg shadow p-3"},U={class:"flex items-center"},A={class:"ml-3"},j={class:"text-lg font-semibold text-gray-900"},q={class:"bg-white rounded-lg shadow p-3"},E={class:"flex items-center"},V={class:"ml-3"},G={class:"text-lg font-semibold text-gray-900"},M={class:"bg-white rounded-lg shadow p-3"},O={class:"flex items-center"},T={class:"ml-3"},z={class:"text-xs font-semibold text-gray-900"},B={class:"bg-white shadow rounded-lg overflow-hidden"},L={class:"min-w-full divide-y divide-gray-200"},N={class:"bg-white divide-y divide-gray-200"},R={key:0},$={class:"px-4 py-2 whitespace-nowrap"},H={class:"flex items-center"},J={class:"ml-3"},P={class:"text-xs font-medium text-gray-900"},K={class:"text-2xs text-gray-500"},Q={class:"px-4 py-2 whitespace-nowrap text-xs text-gray-900"},W={class:"px-4 py-2 whitespace-nowrap text-xs text-right font-mono text-gray-900"},X={class:"px-4 py-2 whitespace-nowrap text-xs text-gray-700"},Y={class:"px-4 py-2 whitespace-nowrap text-center"},Z={class:"px-4 py-2 whitespace-nowrap text-xs text-center text-gray-500"},ee={class:"px-4 py-2 whitespace-nowrap text-center text-xs"},te=["onClick","title"],ae=["onClick"],se={class:"bg-gradient-to-r from-sage to-sage-dark px-4 py-2 rounded-t-lg flex items-center justify-between"},le={class:"text-xs font-semibold text-white"},re={class:"p-3 overflow-y-auto flex-1"},ne={key:0,class:"mb-2 bg-red-50 border border-red-200 text-red-700 px-2 py-1.5 rounded text-2xs"},ie={class:"space-y-2"},oe=["value"],de={class:"relative"},ce={class:"border-t border-gray-200 px-3 py-2 bg-gray-50 rounded-b-lg flex justify-end gap-2"},ue=["disabled"],xe=e({__name:"RecurringEntriesView",setup(e){const xe=t([]),pe=t([]),ye=t(!1),ge=t(!1),me=t(!1),ve=t(!1),fe=t(!1),be=t(null),we=t({id:0,employee_id:"",type:"base_salary",description:"",amount:0,start_date:(new Date).toISOString().split("T")[0],end_date:""}),he=a(()=>xe.value.filter(e=>e.is_active).length),_e=a(()=>xe.value.filter(e=>e.is_active).reduce((e,t)=>e+t.amount,0)),ke=a(()=>{const e=xe.value.map(e=>e.last_generated_for).filter(e=>e).sort().reverse();return e.length>0?Ue(e[0]):null});async function Se(){try{xe.value=await async function(){return(await f.get("/api/admin/recurring-entries")).data}()}catch(e){console.error("Failed to load recurring entries:",e)}}async function Ce(){ye.value=!0;try{await async function(){return(await f.post("/api/admin/recurring-entries/sync")).data}();await Se()}catch(e){console.error("Failed to sync employees:",e)}finally{ye.value=!1}}async function De(){ge.value=!0;try{await async function(){return(await f.post("/api/admin/recurring-entries/generate")).data}();await Se()}catch(e){console.error("Failed to generate entries:",e)}finally{ge.value=!1}}async function Fe(e){try{await async function(e){return(await f.delete(`/api/admin/recurring-entries/${e}`)).data}(e.ID),await Se()}catch(t){console.error("Failed to delete entry:",t)}}function Ie(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100)}function Ue(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short"})}function Ae(){ve.value=!1,we.value={id:0,employee_id:"",type:"base_salary",description:"",amount:0,start_date:(new Date).toISOString().split("T")[0],end_date:""},be.value=null,me.value=!0}function je(){me.value=!1,be.value=null}async function qe(){var e,t;fe.value=!0,be.value=null;try{const e={employee_id:parseInt(we.value.employee_id),type:we.value.type,description:we.value.description,amount:Math.round(100*we.value.amount),frequency:"monthly",start_date:we.value.start_date,end_date:we.value.end_date||void 0,is_active:!0};ve.value?await h(we.value.id,e):await async function(e){return(await f.post("/api/admin/recurring-entries",e)).data}(e),await Se(),je()}catch(a){console.error("Failed to save entry:",a),be.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||a.message||"Failed to save entry"}finally{fe.value=!1}}return s(()=>{Se(),async function(){try{pe.value=await b()}catch(e){console.error("Failed to load employees:",e)}}()}),(e,t)=>(v(),l("div",_,[r("div",k,[t[9]||(t[9]=r("div",null,[r("h1",{class:"text-xl font-bold text-gray-900"},"Recurring Compensation"),r("p",{class:"mt-1 text-xs text-gray-500"}," Manage fixed monthly compensation (base salary, stipends) for staff ")],-1)),r("div",S,[r("button",{onClick:Ae,class:"px-3 py-1.5 bg-sage text-white text-xs rounded hover:bg-sage-dark"},t[7]||(t[7]=[r("i",{class:"fas fa-plus mr-1"},null,-1),i(" Add Entry ")])),r("button",{onClick:Ce,disabled:ye.value,class:"px-3 py-1.5 bg-sky-600 text-white text-xs rounded hover:bg-sky-700 disabled:bg-gray-300"},[r("i",{class:o(["fas fa-sync mr-1",{"fa-spin":ye.value}])},null,2),i(" "+d(ye.value?"Syncing...":"Sync Staff"),1)],8,C),r("button",{onClick:De,disabled:ge.value,class:"px-3 py-1.5 bg-sage text-white text-xs rounded hover:bg-sage-dark disabled:bg-gray-300"},[t[8]||(t[8]=r("i",{class:"fas fa-play mr-1"},null,-1)),i(" "+d(ge.value?"Generating...":"Generate Payroll"),1)],8,D)])]),r("div",F,[r("div",I,[r("div",U,[t[11]||(t[11]=r("div",{class:"flex-shrink-0 bg-sage-pale rounded-md p-2"},[r("i",{class:"fas fa-users text-sage text-sm"})],-1)),r("div",A,[t[10]||(t[10]=r("p",{class:"text-2xs font-medium text-gray-500"},"Active Entries",-1)),r("p",j,d(he.value),1)])])]),r("div",q,[r("div",E,[t[13]||(t[13]=r("div",{class:"flex-shrink-0 bg-blue-50 rounded-md p-2"},[r("i",{class:"fas fa-dollar-sign text-blue-600 text-sm"})],-1)),r("div",V,[t[12]||(t[12]=r("p",{class:"text-2xs font-medium text-gray-500"},"Monthly Fixed Costs",-1)),r("p",G,d(Ie(_e.value)),1)])])]),r("div",M,[r("div",O,[t[15]||(t[15]=r("div",{class:"flex-shrink-0 bg-sage-pale rounded-md p-2"},[r("i",{class:"fas fa-calendar text-sage text-sm"})],-1)),r("div",T,[t[14]||(t[14]=r("p",{class:"text-2xs font-medium text-gray-500"},"Last Generated",-1)),r("p",z,d(ke.value||"Never"),1)])])])]),r("div",B,[r("table",L,[t[18]||(t[18]=r("thead",{class:"bg-gray-50"},[r("tr",null,[r("th",{class:"px-4 py-2 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Employee "),r("th",{class:"px-4 py-2 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Type "),r("th",{class:"px-4 py-2 text-right text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Amount "),r("th",{class:"px-4 py-2 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Frequency "),r("th",{class:"px-4 py-2 text-center text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),r("th",{class:"px-4 py-2 text-center text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Last Generated "),r("th",{class:"px-4 py-2 text-center text-2xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),r("tbody",N,[0===xe.value.length?(v(),l("tr",R,t[16]||(t[16]=[r("td",{colspan:"7",class:"px-4 py-6 text-center text-xs text-gray-500"},[r("i",{class:"fas fa-inbox text-2xl text-gray-300 mb-2"}),r("p",null,"No recurring entries found"),r("p",{class:"text-2xs mt-1"},'Click "Sync Staff" to create entries for salaried employees')],-1)]))):n("",!0),(v(!0),l(c,null,u(xe.value,e=>{var a,s,n,i;return v(),l("tr",{key:e.ID,class:"hover:bg-gray-50"},[r("td",$,[r("div",H,[x(w,{employee:e.employee,size:"sm"},null,8,["employee"]),r("div",J,[r("div",P,d(null==(a=e.employee)?void 0:a.first_name)+" "+d(null==(s=e.employee)?void 0:s.last_name),1),r("div",K,d(null==(n=e.employee)?void 0:n.title),1)])])]),r("td",Q,d((i=e.type,i.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "))),1),r("td",W,d(Ie(e.amount)),1),r("td",X,d(e.frequency),1),r("td",Y,[r("span",{class:o(["px-2 py-0.5 inline-flex text-2xs leading-4 font-semibold rounded-full",e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(e.is_active?"Active":"Inactive"),3)]),r("td",Z,d(e.last_generated_for?Ue(e.last_generated_for):"-"),1),r("td",ee,[r("button",{onClick:t=>async function(e){try{await h(e.ID,{is_active:!e.is_active}),await Se()}catch(t){console.error("Failed to toggle entry:",t)}}(e),class:"text-sky-600 hover:text-sky-900 mr-2",title:e.is_active?"Deactivate":"Activate"},[r("i",{class:o(["fas","text-2xs",e.is_active?"fa-pause":"fa-play"])},null,2)],8,te),r("button",{onClick:t=>Fe(e),class:"text-red-600 hover:text-red-900",title:"Delete"},t[17]||(t[17]=[r("i",{class:"fas fa-trash-alt text-2xs"},null,-1)]),8,ae)])])}),128))])])]),me.value?(v(),l("div",{key:0,onClick:je,class:"fixed inset-0 z-50 flex items-center justify-center bg-gray-500/75 backdrop-blur-sm"},[r("div",{onClick:t[6]||(t[6]=m(()=>{},["stop"])),class:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 max-h-[90vh] flex flex-col"},[r("div",se,[r("h3",le,d(ve.value?"Edit":"Add")+" Recurring Entry ",1),r("button",{onClick:je,class:"text-white hover:text-gray-200"},t[19]||(t[19]=[r("i",{class:"fas fa-times text-xs"},null,-1)]))]),r("div",re,[be.value?(v(),l("div",ne,d(be.value),1)):n("",!0),r("div",ie,[r("div",null,[t[21]||(t[21]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"},[i(" Employee "),r("span",{class:"text-red-500"},"*")],-1)),p(r("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>we.value.employee_id=e),required:"",class:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},[t[20]||(t[20]=r("option",{value:""},"Select employee...",-1)),(v(!0),l(c,null,u(pe.value,e=>(v(),l("option",{key:e.ID,value:e.ID},d(e.first_name)+" "+d(e.last_name),9,oe))),128))],512),[[y,we.value.employee_id]])]),r("div",null,[t[23]||(t[23]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"},[i(" Type "),r("span",{class:"text-red-500"},"*")],-1)),p(r("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>we.value.type=e),required:"",class:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},t[22]||(t[22]=[r("option",{value:"base_salary"},"Base Salary",-1),r("option",{value:"bonus"},"Bonus",-1),r("option",{value:"stipend"},"Stipend",-1),r("option",{value:"other"},"Other",-1)]),512),[[y,we.value.type]])]),r("div",null,[t[24]||(t[24]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"},[i(" Description "),r("span",{class:"text-red-500"},"*")],-1)),p(r("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>we.value.description=e),type:"text",required:"",placeholder:"e.g., Monthly Base Salary",class:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},null,512),[[g,we.value.description]])]),r("div",null,[t[26]||(t[26]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"},[i(" Monthly Amount "),r("span",{class:"text-red-500"},"*")],-1)),r("div",de,[t[25]||(t[25]=r("span",{class:"absolute left-3 top-1.5 text-gray-500 text-xs"},"$",-1)),p(r("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>we.value.amount=e),type:"number",step:"0.01",required:"",class:"w-full pl-8 pr-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},null,512),[[g,we.value.amount,void 0,{number:!0}]])])]),r("div",null,[t[27]||(t[27]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"},[i(" Start Date "),r("span",{class:"text-red-500"},"*")],-1)),p(r("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>we.value.start_date=e),type:"date",required:"",class:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},null,512),[[g,we.value.start_date]])]),r("div",null,[t[28]||(t[28]=r("label",{class:"block text-2xs font-medium text-gray-700 mb-1"}," End Date (Optional) ",-1)),p(r("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>we.value.end_date=e),type:"date",class:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-sage focus:border-sage"},null,512),[[g,we.value.end_date]])])])]),r("div",ce,[r("button",{onClick:je,class:"px-3 py-1.5 text-xs text-gray-700 border border-gray-300 rounded hover:bg-gray-50"}," Cancel "),r("button",{onClick:qe,disabled:fe.value,class:"px-3 py-1.5 text-xs bg-sage text-white rounded hover:bg-sage-dark disabled:bg-gray-300"},d(fe.value?"Saving...":ve.value?"Update":"Create"),9,ue)])])])):n("",!0)]))}});export{xe as default};
