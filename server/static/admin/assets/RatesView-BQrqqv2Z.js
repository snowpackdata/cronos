import{f as e,d as t,u as a,c as s}from"./rates-Bm4DowW0.js";import{b as l,r as n,w as o,A as i,o as r,C as u,D as c,u as m,a as d,y as f,E as p,z as v,H as y,J as x,I as g,K as b,c as w,q as _,h,f as D,F as E,G as I,x as T,_ as A}from"./index-2uCPEpPG.js";import{p as k,b as L,a as N,f as C}from"./dateUtils-kXVih0JO.js";import{r as R}from"./XMarkIcon-Bml7Cvcl.js";import{Y as B,h as P,G as U,V as j,S}from"./transition-CMIuM6C3.js";import{_ as V}from"./ConfirmationModal-DUMFrYPd.js";const Y={class:"fixed inset-0 overflow-hidden"},O={class:"absolute inset-0 overflow-hidden"},F={class:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10 sm:pl-16"},M={class:"flex-1"},$={class:"bg-sage-dark px-4 py-6 sm:px-6"},X={class:"flex items-start justify-between space-x-3"},z={class:"space-y-1"},H={class:"text-sm text-gray-100"},q={class:"flex h-7 items-center"},G={class:"space-y-6 py-6 sm:space-y-0 sm:divide-y sm:divide-gray-200 sm:py-0"},J={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},K={class:"sm:col-span-2"},Q={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},W={class:"sm:col-span-2"},Z={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},ee={class:"sm:col-span-2"},te={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},ae={class:"sm:col-span-2"},se={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},le={class:"sm:col-span-2"},ne={class:"space-y-2 px-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:space-y-0 sm:px-6 sm:py-5"},oe={class:"sm:col-span-2 flex items-center"},ie={class:"shrink-0 border-t border-gray-200 px-4 py-5 sm:px-6"},re={class:"flex justify-end space-x-3"},ue={type:"submit",class:"inline-flex justify-center rounded-md bg-sage px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-sage-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sage"},ce={__name:"RateDrawer",props:{isOpen:{type:Boolean,default:!1},rateData:{type:Object,default:()=>({})}},emits:["close","save","delete"],setup(e,{emit:t}){var a,s,h,D,E,I,T;const A=e,C=t,V=()=>{C("close")},ce=()=>{window.confirm("Are you sure you want to delete this rate? This action cannot be undone and may affect billing codes that use this rate.")&&C("delete",A.rateData)},me=l(()=>{var e;return!!(null==(e=A.rateData)?void 0:e.ID)}),de=n({ID:(null==(a=A.rateData)?void 0:a.ID)||null,name:(null==(s=A.rateData)?void 0:s.name)||"",type:(null==(h=A.rateData)?void 0:h.type)||"RATE_TYPE_EXTERNAL_CLIENT_BILLABLE",amount:(null==(D=A.rateData)?void 0:D.amount)||0,startDate:(null==(E=A.rateData)?void 0:E.active_from)?k(A.rateData.active_from):L(),endDate:(null==(I=A.rateData)?void 0:I.active_to)?k(A.rateData.active_to):"",internal_only:(null==(T=A.rateData)?void 0:T.internal_only)||!1});o(()=>A.rateData,e=>{e?de.value={ID:e.ID||null,name:e.name||"",type:e.type||"RATE_TYPE_EXTERNAL_CLIENT_BILLABLE",amount:e.amount||0,startDate:e.active_from?k(e.active_from):L(),endDate:e.active_to?k(e.active_to):""}:resetForm()},{deep:!0});const fe=()=>{if(!de.value.name||!de.value.amount||!de.value.startDate)return alert("Please fill in all required fields"),void console.error("Validation failed - missing required fields",{name:de.value.name,amount:de.value.amount,startDate:de.value.startDate});const e=l(()=>({ID:de.value.ID,name:de.value.name.trim(),type:de.value.type,amount:parseFloat(de.value.amount.toString()),active_from:N(de.value.startDate),active_to:N(de.value.endDate)}));if(de.value.startDate)e.value.active_from=de.value.startDate;else{const t=new Date;e.value.active_from=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}de.value.endDate?e.value.active_to=de.value.endDate:e.value.active_to="",C("save",e.value)};return(t,a)=>(r(),i(m(S),{as:"template",show:e.isOpen},{default:u(()=>[c(m(B),{class:"relative z-10",onClose:V},{default:u(()=>[a[16]||(a[16]=d("div",{class:"fixed inset-0"},null,-1)),d("div",Y,[d("div",O,[d("div",F,[c(m(P),{as:"template",enter:"transform transition ease-in-out duration-500 sm:duration-700","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:u(()=>[c(m(U),{class:"pointer-events-auto w-screen max-w-2xl"},{default:u(()=>[d("form",{class:"flex h-full flex-col overflow-y-scroll bg-white shadow-xl",onSubmit:f(fe,["prevent"])},[d("div",M,[d("div",$,[d("div",X,[d("div",z,[c(m(j),{class:"text-base font-semibold text-white"},{default:u(()=>[p(v(me.value?"Edit Rate":"New Rate"),1)]),_:1}),d("p",H,v(me.value?"Update the rate details below.":"Get started by filling in the information below to create a new rate."),1)]),d("div",q,[d("button",{type:"button",class:"relative text-white hover:text-gray-200",onClick:V},[a[6]||(a[6]=d("span",{class:"absolute -inset-2.5"},null,-1)),a[7]||(a[7]=d("span",{class:"sr-only"},"Close panel",-1)),c(m(R),{class:"h-6 w-6","aria-hidden":"true"})])])])]),d("div",G,[d("div",J,[a[8]||(a[8]=d("div",null,[d("label",{for:"rate-name",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"Rate name")],-1)),d("div",K,[y(d("input",{type:"text",name:"rate-name",id:"rate-name","onUpdate:modelValue":a[0]||(a[0]=e=>de.value.name=e),class:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-sage sm:text-sm/6"},null,512),[[x,de.value.name]])])]),d("div",Q,[a[10]||(a[10]=d("div",null,[d("label",{for:"rate-type",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"Rate Type")],-1)),d("div",W,[y(d("select",{id:"rate-type",name:"rate-type","onUpdate:modelValue":a[1]||(a[1]=e=>de.value.type=e),class:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-sage sm:text-sm/6"},a[9]||(a[9]=[d("option",{value:"RATE_TYPE_INTERNAL_CLIENT_NON_BILLABLE"},"Internal Client Non-Billable",-1),d("option",{value:"RATE_TYPE_INTERNAL_CLIENT_BILLABLE"},"Internal Client Billable",-1),d("option",{value:"RATE_TYPE_INTERNAL_ADMINISTRATIVE"},"Internal Administrative",-1),d("option",{value:"RATE_TYPE_INTERNAL_ADMINISTRATIVE_NON_BILLABLE"},"Internal Administrative Non-Billable",-1),d("option",{value:"RATE_TYPE_EXTERNAL_CLIENT_BILLABLE"},"External Client Billable",-1),d("option",{value:"RATE_TYPE_EXTERNAL_CLIENT_NON_BILLABLE"},"External Client Non-Billable",-1),d("option",{value:"RATE_TYPE_INTERNAL_PROJECT"},"Internal Project",-1)]),512),[[g,de.value.type]])])]),d("div",Z,[a[11]||(a[11]=d("div",null,[d("label",{for:"rate-amount",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"Rate Amount ($)")],-1)),d("div",ee,[y(d("input",{type:"number",name:"rate-amount",id:"rate-amount","onUpdate:modelValue":a[2]||(a[2]=e=>de.value.amount=e),min:"0",step:"0.01",class:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-sage sm:text-sm/6"},null,512),[[x,de.value.amount]])])]),d("div",te,[a[12]||(a[12]=d("div",null,[d("label",{for:"rate-start-date",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"Start Date")],-1)),d("div",ae,[y(d("input",{type:"date",name:"rate-start-date",id:"rate-start-date","onUpdate:modelValue":a[3]||(a[3]=e=>de.value.startDate=e),class:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-sage sm:text-sm/6"},null,512),[[x,de.value.startDate]])])]),d("div",se,[a[13]||(a[13]=d("div",null,[d("label",{for:"rate-end-date",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"End Date")],-1)),d("div",le,[y(d("input",{type:"date",name:"rate-end-date",id:"rate-end-date","onUpdate:modelValue":a[4]||(a[4]=e=>de.value.endDate=e),class:"block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-sage sm:text-sm/6"},null,512),[[x,de.value.endDate]])])]),d("div",ne,[a[15]||(a[15]=d("div",null,[d("label",{for:"internal-only",class:"block text-sm/6 font-medium text-gray-900 sm:mt-1.5"},"Internal Only")],-1)),d("div",oe,[y(d("input",{type:"checkbox",name:"internal-only",id:"internal-only","onUpdate:modelValue":a[5]||(a[5]=e=>de.value.internal_only=e),class:"h-4 w-4 rounded border-gray-300 text-sage focus:ring-sage"},null,512),[[b,de.value.internal_only]]),a[14]||(a[14]=d("label",{for:"internal-only",class:"ml-2 text-sm text-gray-600"}," Mark this rate as internal only ",-1))])])])]),d("div",ie,[d("div",re,[d("button",{type:"button",class:"rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",onClick:V}," Cancel "),me.value?(r(),w("button",{key:0,type:"button",class:"rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",onClick:ce}," Delete ")):_("",!0),d("button",ue,v(me.value?"Update":"Create"),1)])])],32)]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["show"]))}},me={class:"px-4 py-6 sm:px-6 lg:px-8"},de={class:"sm:flex sm:items-center"},fe={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},pe={key:0,class:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow mt-6"},ve={key:1,class:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow mt-6"},ye={class:"text-gray-dark mb-2"},xe={key:2,class:"bg-white shadow rounded-lg mt-8"},ge={role:"list",class:"divide-y divide-gray-100"},be={class:"min-w-0 flex-1"},we={class:"flex items-start gap-x-3"},_e={class:"text-sm/6 font-semibold text-gray-900"},he={key:0,class:"text-gray-600 bg-gray-50 ring-gray-500/10 mt-0.5 whitespace-nowrap rounded-md px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset"},De={class:"mt-1 flex items-center gap-x-2 text-xs/5 text-gray-500"},Ee={class:"whitespace-nowrap"},Ie={class:"font-medium"},Te={class:"whitespace-nowrap"},Ae=["datetime"],ke={key:0,viewBox:"0 0 2 2",class:"size-0.5 fill-current"},Le={key:1,class:"whitespace-nowrap"},Ne=["datetime"],Ce={class:"flex flex-none items-center gap-x-4"},Re=["onClick"],Be={key:0,class:"py-5 px-4"},Pe=A(h({__name:"RatesView",setup(o){const i=n([]),u=n(!0),f=n(null),y=n(!1),x=n(null),g=n(!1),b=l(()=>i.value&&Array.isArray(i.value)?[...i.value].sort((e,t)=>{const a=R(e),s=R(t);return a&&!s?-1:!a&&s?1:0}):[]);D(async()=>{await h()});const h=async()=>{u.value=!0,f.value=null;try{try{await fetch("/api/rates")}catch(t){console.error("Direct fetch error:",t)}const a=await e();if(!a||!Array.isArray(a))return console.error("Invalid response format - expected array but got:",typeof a),f.value="Invalid response format from API",void(i.value=[]);i.value=a}catch(a){console.error("Error fetching rates:",a),console.error("Error details:",a instanceof Error?a.message:String(a)),a instanceof Error&&a.stack&&console.error("Stack trace:",a.stack),f.value="Failed to load rates. Please try again.",i.value=[]}finally{u.value=!1}},A=async e=>{try{e.ID&&e.ID>0?await a(e):await s(e),await h(),L()}catch(t){console.error("Error saving rate:",t),alert("Failed to save rate. Please try again.")}},k=(e=null)=>{x.value=e,y.value=!0},L=()=>{y.value=!1,x.value=null},N=async e=>{if(e)try{await t(Number(e.ID)),await h(),L()}catch(a){console.error("Error deleting rate:",a),alert("Failed to delete rate. Please try again.")}},R=e=>{if(!e)return!1;const t=new Date;t.setUTCHours(0,0,0,0);let a=null,s=null;if(e.active_from){if("string"==typeof e.active_from&&e.active_from.match(/^\d{4}-\d{2}-\d{2}$/)){const[t,s,l]=e.active_from.split("-").map(Number);a=new Date(Date.UTC(t,s-1,l))}else a=new Date(e.active_from);a.setUTCHours(0,0,0,0)}if(e.active_to){if("string"==typeof e.active_to&&e.active_to.match(/^\d{4}-\d{2}-\d{2}$/)){const[t,a,l]=e.active_to.split("-").map(Number);s=new Date(Date.UTC(t,a-1,l))}else s=new Date(e.active_to);s.setUTCHours(0,0,0,0)}return(!a||t>=a)&&(!s||t<=s)};return(e,t)=>(r(),w("div",me,[d("div",de,[t[3]||(t[3]=d("div",{class:"sm:flex-auto"},[d("h1",{class:"text-base font-semibold leading-6 text-gray-900"},"Rates"),d("p",{class:"mt-2 text-sm text-gray-700"}," A list of all rates including their name, amount, and effective dates. ")],-1)),d("div",fe,[d("button",{type:"button",onClick:t[0]||(t[0]=e=>k()),class:"block rounded-md bg-sage px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-sage-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sage"}," Create new rate ")])]),u.value?(r(),w("div",pe,t[4]||(t[4]=[d("i",{class:"fas fa-spinner fa-spin text-4xl text-teal mb-4"},null,-1),d("span",{class:"text-gray-dark"},"Loading rates...",-1)]))):f.value?(r(),w("div",ve,[t[6]||(t[6]=d("i",{class:"fas fa-exclamation-circle text-4xl text-red mb-4"},null,-1)),d("span",ye,v(f.value),1),d("button",{onClick:h,class:"btn-secondary mt-4"},t[5]||(t[5]=[d("i",{class:"fas fa-sync mr-2"},null,-1),p(" Retry ")]))])):(r(),w("div",xe,[d("ul",ge,[(r(!0),w(E,null,I(b.value,e=>{return r(),w("li",{key:e.ID,class:"flex items-center justify-between gap-x-6 py-5 px-4 hover:bg-gray-50"},[d("div",be,[d("div",we,[d("p",_e,v(e.name),1),d("p",{class:T([R(e)?"text-green-700 bg-green-50 ring-green-600/20":"text-red-700 bg-red-50 ring-red-600/20","mt-0.5 whitespace-nowrap rounded-md px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset"])},v(R(e)?"Active":"Inactive"),3),e.internal_only?(r(),w("p",he," Internal Only ")):_("",!0)]),d("div",De,[d("p",Ee,[d("span",Ie,v((a=e.amount,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a))),1)]),t[10]||(t[10]=d("svg",{viewBox:"0 0 2 2",class:"size-0.5 fill-current"},[d("circle",{cx:"1",cy:"1",r:"1"})],-1)),d("p",Te,[t[7]||(t[7]=p(" Active from ")),d("time",{datetime:e.active_from},v(m(C)(e.active_from)),9,Ae)]),e.active_to?(r(),w("svg",ke,t[8]||(t[8]=[d("circle",{cx:"1",cy:"1",r:"1"},null,-1)]))):_("",!0),e.active_to?(r(),w("p",Le,[t[9]||(t[9]=p(" to ")),d("time",{datetime:e.active_to},v(m(C)(e.active_to)),9,Ne)])):_("",!0)])]),d("div",Ce,[d("button",{onClick:t=>k(e),class:"rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"},t[11]||(t[11]=[d("i",{class:"fas fa-pencil-alt mr-1"},null,-1),p(" Edit ")]),8,Re)])]);var a}),128)),0===b.value.length?(r(),w("li",Be,t[12]||(t[12]=[d("div",{class:"flex flex-col items-center justify-center p-10"},[d("i",{class:"fas fa-calculator text-5xl text-gray-300 mb-4"}),d("p",{class:"text-lg font-medium text-gray-dark"},"No rates found"),d("p",{class:"text-gray mb-4"},'Click "Create new rate" to add one')],-1)]))):_("",!0)])])),c(ce,{"is-open":y.value,"rate-data":x.value,onClose:L,onSave:A,onDelete:N},null,8,["is-open","rate-data"]),c(V,{show:g.value,title:"Delete Rate",message:"Are you sure you want to delete this rate? This action cannot be undone and may affect billing codes that use this rate.",onConfirm:t[1]||(t[1]=e=>x.value&&N(x.value)),onCancel:t[2]||(t[2]=e=>g.value=!1)},null,8,["show"])]))}}),[["__scopeId","data-v-ab83e275"]]);export{Pe as default};
