import{h as e,r as t,b as a,f as l,c as o,a as c,q as s,H as n,I as u,L as i,J as r,K as d,F as v,G as y,z as p,x,E as b,y as g,o as m}from"./index-2uCPEpPG.js";import{a as f,g as _,s as h,u as k,c as w,b as E,d as C,e as A,f as S}from"./subaccounts-iRweACMr.js";import"./index-8V-xrl-L.js";const T={class:"p-2 bg-white min-h-screen"},U={class:"bg-gray-50 border border-gray-300 rounded px-1.5 py-0.5 mb-1 flex gap-2 items-center"},V={class:"flex-1"},L={class:"flex-1"},I={class:"flex items-center gap-1"},O={key:0,class:"text-center py-2"},N={key:1,class:"space-y-2"},F={class:"bg-gray-900 text-white px-3 py-1"},j={class:"text-xs font-bold uppercase tracking-wide"},P={class:"w-full text-xs"},q=["onClick"],D={class:"px-3 py-1 text-gray-400"},R={class:"px-3 py-1 font-mono text-gray-900"},Y={key:0,class:"ml-1 text-gray-400"},X={class:"px-3 py-1 font-medium text-gray-900"},z={class:"px-3 py-1 text-gray-600"},M=["onClick"],B=["onClick"],Q=["onClick"],$={class:"px-3 py-1 pl-8 font-mono text-gray-700"},J={class:"px-3 py-1 text-gray-600"},G={class:"px-3 py-1 text-gray-600"},H={class:"px-3 py-1 text-center"},K=["onClick"],W=["onClick"],Z={key:0,class:"px-3 py-2 text-center text-xs text-gray-500"},ee={key:2,class:"fixed inset-0 bg-gray-500/75 flex items-center justify-center z-50"},te={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-2"},ae={class:"bg-sage px-3 py-2 rounded-t-lg flex justify-between items-center"},le={class:"text-xs font-semibold text-white"},oe={key:0,class:"mb-2 p-2 bg-red-50 border border-red-200 rounded"},ce={class:"text-2xs text-red-600"},se={class:"space-y-2"},ne=["disabled"],ue=["disabled"],ie={class:"flex items-center gap-1.5"},re={class:"flex justify-end gap-1.5 mt-2.5 pt-2 border-t border-gray-200"},de=["disabled"],ve={key:3,class:"fixed inset-0 bg-gray-500/75 flex items-center justify-center z-50"},ye={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-2"},pe={class:"bg-sage px-3 py-2 rounded-t-lg flex justify-between items-center"},xe={class:"text-xs font-semibold text-white"},be={key:0,class:"mb-2 p-2 bg-red-50 border border-red-200 rounded"},ge={class:"text-2xs text-red-600"},me={class:"space-y-2"},fe=["value"],_e=["disabled"],he={class:"flex items-center gap-1.5"},ke={class:"flex justify-end gap-1.5 mt-2.5 pt-2 border-t border-gray-200"},we=["disabled"],Ee=e({__name:"ChartOfAccountsView",setup(e){const Ee=t([]),Ce=t([]),Ae=t(new Set),Se=t(!1),Te=t(""),Ue=t({accountType:"",activeOnly:!0}),Ve=t(!1),Le=t(!1),Ie=t(!1),Oe=t(null),Ne=t(null),Fe=t({account_code:"",account_name:"",account_type:"EXPENSE",description:"",is_active:!0}),je=t(!1),Pe=t(!1),qe=t(null),De=t({code:"",name:"",account_code:"",type:"CUSTOM",is_active:!0}),Re=a(()=>Ue.value.accountType?[Ue.value.accountType]:["ASSET","LIABILITY","EQUITY","REVENUE","EXPENSE"]),Ye=a(()=>{let e=Ee.value;if(Te.value){const t=Te.value.toLowerCase();e=e.filter(e=>e.account_code.toLowerCase().includes(t)||e.account_name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t))}return e});function Xe(e){return Ye.value.filter(t=>t.account_type===e)}function ze(e){return Ce.value.filter(t=>t.account_code===e)}async function Me(){Se.value=!0;try{if(Ee.value=await _({account_type:Ue.value.accountType||void 0,active_only:Ue.value.activeOnly}),0===Ee.value.length)try{await h(),Ee.value=await _({account_type:Ue.value.accountType||void 0,active_only:Ue.value.activeOnly})}catch(e){console.error("Failed to seed system accounts:",e)}Ce.value=[]}catch(e){console.error("Failed to fetch data:",e)}finally{Se.value=!1}}function Be(){Le.value=!1,Ne.value=null,Oe.value=null,Fe.value={account_code:"",account_name:"",account_type:"EXPENSE",description:"",is_active:!0},Ve.value=!0}function Qe(){Ve.value=!1,Le.value=!1,Ne.value=null,Oe.value=null}async function $e(){var e,t;Ie.value=!0,Oe.value=null;try{if(Le.value&&Ne.value){const e={account_name:Fe.value.account_name,description:Fe.value.description,is_active:Fe.value.is_active};await k(Ne.value,e)}else await w(Fe.value);await Me(),Qe()}catch(a){console.error("Failed to save account:",a),Oe.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||"Failed to save account"}finally{Ie.value=!1}}function Je(){je.value=!1,Pe.value=!1,qe.value=null,Oe.value=null}async function Ge(){var e,t;Ie.value=!0,Oe.value=null;try{if(Pe.value&&qe.value){const e={name:De.value.name,type:De.value.type,is_active:De.value.is_active};await E(qe.value,e)}else await C(De.value);await Me(),Ae.value.add(De.value.account_code),Je()}catch(a){console.error("Failed to save subaccount:",a),Oe.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||"Failed to save subaccount"}finally{Ie.value=!1}}return l(async()=>{await Me()}),(e,t)=>(m(),o("div",T,[c("div",{class:"mb-1 pb-1 border-b border-gray-900 flex justify-between items-center"},[t[13]||(t[13]=c("div",null,[c("h1",{class:"text-sm font-bold text-gray-900 uppercase"},"Chart of Accounts")],-1)),c("div",{class:"flex gap-1"},[c("button",{onClick:Be,class:"px-2 py-0.5 text-2xs font-medium text-white bg-sky-700 hover:bg-sky-800 rounded"}," + Account ")])]),c("div",U,[c("div",V,[n(c("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>Ue.value.accountType=e),onChange:Me,class:"block w-full rounded border-gray-300 text-2xs py-0.5"},t[14]||(t[14]=[i('<option value="">All Types</option><option value="ASSET">Assets</option><option value="LIABILITY">Liabilities</option><option value="EQUITY">Equity</option><option value="REVENUE">Revenue</option><option value="EXPENSE">Expenses</option>',6)]),544),[[u,Ue.value.accountType]])]),c("div",L,[n(c("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>Te.value=e),type:"text",placeholder:"Search...",class:"block w-full rounded border-gray-300 text-2xs py-0.5"},null,512),[[r,Te.value]])]),c("div",I,[n(c("input",{id:"activeOnly","onUpdate:modelValue":t[2]||(t[2]=e=>Ue.value.activeOnly=e),onChange:Me,type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-sky-700"},null,544),[[d,Ue.value.activeOnly]]),t[15]||(t[15]=c("label",{for:"activeOnly",class:"text-2xs text-gray-700 whitespace-nowrap"},"Active only",-1))])]),Se.value?(m(),o("div",O,t[16]||(t[16]=[c("p",{class:"text-2xs text-gray-500"},"Loading...",-1)]))):(m(),o("div",N,[(m(!0),o(v,null,y(Re.value,e=>(m(),o("div",{key:e,class:"border border-gray-900"},[c("div",F,[c("h2",j,p(e),1)]),c("table",P,[t[23]||(t[23]=c("thead",{class:"bg-gray-100 border-b border-gray-300"},[c("tr",null,[c("th",{class:"px-3 py-1 text-left font-semibold text-gray-700 uppercase w-8"}),c("th",{class:"px-3 py-1 text-left font-semibold text-gray-700 uppercase"},"Code"),c("th",{class:"px-3 py-1 text-left font-semibold text-gray-700 uppercase"},"Name"),c("th",{class:"px-3 py-1 text-left font-semibold text-gray-700 uppercase"},"Description"),c("th",{class:"px-3 py-1 text-center font-semibold text-gray-700 uppercase w-20"},"Actions")])],-1)),c("tbody",null,[(m(!0),o(v,null,y(Xe(e),e=>(m(),o(v,{key:e.ID},[c("tr",{class:"border-b border-gray-100 hover:bg-gray-50 cursor-pointer",onClick:t=>async function(e){if(Ae.value.has(e))Ae.value.delete(e);else if(Ae.value.add(e),!Ce.value.some(t=>t.account_code===e))try{const t=await f({account_code:e,active_only:Ue.value.activeOnly});Ce.value=[...Ce.value,...t]}catch(t){console.error(`Failed to fetch subaccounts for ${e}:`,t)}}(e.account_code)},[c("td",D,[ze(e.account_code).length>0?(m(),o("i",{key:0,class:x([Ae.value.has(e.account_code)?"fas fa-chevron-down":"fas fa-chevron-right","text-xs"])},null,2)):s("",!0)]),c("td",R,[b(p(e.account_code)+" ",1),e.is_system_defined?(m(),o("span",Y,"(Sys)")):s("",!0)]),c("td",X,p(e.account_name),1),c("td",z,p(e.description),1),c("td",{class:"px-3 py-1 text-center",onClick:t[3]||(t[3]=g(()=>{},["stop"]))},[c("button",{onClick:t=>{return a=e.account_code,Pe.value=!1,qe.value=null,Oe.value=null,De.value={code:"",name:"",account_code:a,type:"CUSTOM",is_active:!0},void(je.value=!0);var a},class:"text-sage hover:text-sage-dark transition-colors",title:"Add subaccount"},t[17]||(t[17]=[c("i",{class:"fas fa-plus text-xs"},null,-1)]),8,M),e.is_system_defined?s("",!0):(m(),o("button",{key:0,onClick:t=>function(e){Le.value=!0,Ne.value=e.account_code,Oe.value=null,Fe.value={account_code:e.account_code,account_name:e.account_name,account_type:e.account_type,description:e.description||"",is_active:e.is_active},Ve.value=!0}(e),class:"ml-2 text-sky-700 hover:text-sky-900 transition-colors",title:"Edit account"},t[18]||(t[18]=[c("i",{class:"fas fa-edit text-xs"},null,-1)]),8,B)),e.is_system_defined?s("",!0):(m(),o("button",{key:1,onClick:t=>async function(e){if(confirm(`Are you sure you want to deactivate ${e}?`))try{await A(e),await Me()}catch(t){console.error("Failed to deactivate account:",t),alert("Failed to deactivate account")}}(e.account_code),class:"ml-2 text-red hover:text-red-700 transition-colors",title:"Deactivate account"},t[19]||(t[19]=[c("i",{class:"fas fa-trash-alt text-xs"},null,-1)]),8,Q))])],8,q),Ae.value.has(e.account_code)?(m(!0),o(v,{key:0},y(ze(e.account_code),e=>(m(),o("tr",{key:e.ID,class:"bg-gray-50 border-b border-gray-100"},[t[22]||(t[22]=c("td",{class:"px-3 py-1"},null,-1)),c("td",$,p(e.code),1),c("td",J,p(e.name),1),c("td",G,p(e.type),1),c("td",H,[c("button",{onClick:t=>{return a=e,Pe.value=!0,qe.value=a.code,Oe.value=null,De.value={code:a.code,name:a.name,account_code:a.account_code,type:a.type,is_active:a.is_active},void(je.value=!0);var a},class:"text-sky-700 hover:text-sky-900 transition-colors",title:"Edit subaccount"},t[20]||(t[20]=[c("i",{class:"fas fa-edit text-xs"},null,-1)]),8,K),c("button",{onClick:t=>async function(e){if(confirm(`Are you sure you want to deactivate ${e}?`))try{await S(e),await Me()}catch(t){console.error("Failed to deactivate subaccount:",t),alert("Failed to deactivate subaccount")}}(e.code),class:"ml-2 text-red hover:text-red-700 transition-colors",title:"Deactivate subaccount"},t[21]||(t[21]=[c("i",{class:"fas fa-trash-alt text-xs"},null,-1)]),8,W)])]))),128)):s("",!0)],64))),128))])]),0===Xe(e).length?(m(),o("div",Z," No "+p(e.toLowerCase())+" accounts found ",1)):s("",!0)]))),128))])),Ve.value?(m(),o("div",ee,[c("div",te,[c("div",ae,[c("h3",le,p(Le.value?"Edit Account":"Create Account"),1),c("button",{onClick:Qe,class:"text-white hover:text-gray-200"},t[24]||(t[24]=[c("span",{class:"text-lg"},"×",-1)]))]),c("form",{onSubmit:g($e,["prevent"]),class:"p-3"},[Oe.value?(m(),o("div",oe,[c("p",ce,p(Oe.value),1)])):s("",!0),c("div",se,[c("div",null,[t[25]||(t[25]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Account Code*",-1)),n(c("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>Fe.value.account_code=e),disabled:Le.value,required:"",type:"text",class:"block w-full rounded border-gray-300 text-2xs py-0.5 disabled:bg-gray-100"},null,8,ne),[[r,Fe.value.account_code]])]),c("div",null,[t[26]||(t[26]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Account Name*",-1)),n(c("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>Fe.value.account_name=e),required:"",type:"text",class:"block w-full rounded border-gray-300 text-2xs py-0.5"},null,512),[[r,Fe.value.account_name]])]),c("div",null,[t[28]||(t[28]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Account Type*",-1)),n(c("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>Fe.value.account_type=e),disabled:Le.value,required:"",class:"block w-full rounded border-gray-300 text-2xs py-0.5 disabled:bg-gray-100"},t[27]||(t[27]=[i('<option value="ASSET">Asset</option><option value="LIABILITY">Liability</option><option value="EQUITY">Equity</option><option value="REVENUE">Revenue</option><option value="EXPENSE">Expense</option>',5)]),8,ue),[[u,Fe.value.account_type]])]),c("div",null,[t[29]||(t[29]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Description",-1)),n(c("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>Fe.value.description=e),rows:"2",class:"block w-full rounded border-gray-300 text-2xs py-0.5"},null,512),[[r,Fe.value.description]])]),c("div",ie,[n(c("input",{id:"is_active_account","onUpdate:modelValue":t[8]||(t[8]=e=>Fe.value.is_active=e),type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-sky-700"},null,512),[[d,Fe.value.is_active]]),t[30]||(t[30]=c("label",{for:"is_active_account",class:"text-2xs text-gray-700"},"Active",-1))])]),c("div",re,[c("button",{type:"button",onClick:Qe,class:"px-2.5 py-1 text-2xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50"}," Cancel "),c("button",{type:"submit",disabled:Ie.value,class:"px-2.5 py-1 text-2xs font-medium text-white bg-sky-700 rounded hover:bg-sky-800 disabled:bg-gray-400"},p(Ie.value?"Saving...":Le.value?"Update":"Create"),9,de)])],32)])])):s("",!0),je.value?(m(),o("div",ve,[c("div",ye,[c("div",pe,[c("h3",xe,p(Pe.value?"Edit Subaccount":"Create Subaccount"),1),c("button",{onClick:Je,class:"text-white hover:text-gray-200"},t[31]||(t[31]=[c("span",{class:"text-lg"},"×",-1)]))]),c("form",{onSubmit:g(Ge,["prevent"]),class:"p-3"},[Oe.value?(m(),o("div",be,[c("p",ge,p(Oe.value),1)])):s("",!0),c("div",me,[c("div",null,[t[32]||(t[32]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Parent Account",-1)),c("input",{value:De.value.account_code,disabled:"",type:"text",class:"block w-full rounded border-gray-300 text-2xs py-0.5 bg-gray-100"},null,8,fe)]),c("div",null,[t[33]||(t[33]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Subaccount Code*",-1)),n(c("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>De.value.code=e),disabled:Pe.value,required:"",type:"text",class:"block w-full rounded border-gray-300 text-2xs py-0.5 disabled:bg-gray-100"},null,8,_e),[[r,De.value.code]])]),c("div",null,[t[34]||(t[34]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Subaccount Name*",-1)),n(c("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>De.value.name=e),required:"",type:"text",class:"block w-full rounded border-gray-300 text-2xs py-0.5"},null,512),[[r,De.value.name]])]),c("div",null,[t[36]||(t[36]=c("label",{class:"block text-2xs font-medium text-gray-700 mb-0.5"},"Type",-1)),n(c("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>De.value.type=e),class:"block w-full rounded border-gray-300 text-2xs py-0.5"},t[35]||(t[35]=[i('<option value="CUSTOM">Custom</option><option value="CLIENT">Client</option><option value="VENDOR">Vendor</option><option value="EMPLOYEE">Employee</option><option value="PROJECT">Project</option>',5)]),512),[[u,De.value.type]])]),c("div",he,[n(c("input",{id:"is_active_subaccount","onUpdate:modelValue":t[12]||(t[12]=e=>De.value.is_active=e),type:"checkbox",class:"h-3 w-3 rounded border-gray-300 text-sky-700"},null,512),[[d,De.value.is_active]]),t[37]||(t[37]=c("label",{for:"is_active_subaccount",class:"text-2xs text-gray-700"},"Active",-1))])]),c("div",ke,[c("button",{type:"button",onClick:Je,class:"px-2.5 py-1 text-2xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50"}," Cancel "),c("button",{type:"submit",disabled:Ie.value,class:"px-2.5 py-1 text-2xs font-medium text-white bg-sky-700 rounded hover:bg-sky-800 disabled:bg-gray-400"},p(Ie.value?"Saving...":Pe.value?"Update":"Create"),9,we)])],32)])])):s("",!0)]))}});export{Ee as default};
