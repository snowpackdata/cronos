import{N as e,O as t,B as r}from"./index-2uCPEpPG.js";function i(e){const t=[];if(e.billing_code_id||t.push("Billing code is required"),e.start||t.push("Start time is required"),e.end||t.push("End time is required"),e.start&&e.end){const r=new Date(e.start),i=new Date(e.end);i<=r&&t.push("End time must be after start time");(i.getTime()-r.getTime())/36e5>24&&t.push("Duration exceeds 24 hours, please verify the times")}return{isValid:0===t.length,errors:t}}const s={async getEntries(t,r,i){let s="entries";const n=new URLSearchParams;t&&n.append("start_date",t),r&&n.append("end_date",r),i&&n.append("user_id",i.toString()),n.toString()&&(s+=`?${n.toString()}`);return(await e(s)).map(e=>({...e,entry_id:Number(e.entry_id),billing_code_id:Number(e.billing_code_id),project_id:Number(e.project_id),user_id:Number(e.user_id),duration_hours:Number(e.duration_hours),fee:Number(e.fee),impersonate_as_user_id:e.impersonate_as_user_id?Number(e.impersonate_as_user_id):null,is_being_impersonated:Boolean(e.is_being_impersonated)}))},getUsers:async()=>e("staff"),getActiveBillingCodes:async()=>(await e("active_billing_codes")).map(e=>{const t=e.id||e.billing_code_id||e.ID,r=Number(t),i=!isNaN(r)&&r>0?r:null;return null===i&&console.warn("Found billing code with invalid ID:",e),{...e,id:i,billing_code_id:i}}).filter(e=>null!==e.id),async createEntry(e){const t=i(e);if(!t.isValid)throw new Error(`Validation failed: ${t.errors.join(", ")}`);const s=new URLSearchParams,n=Number(e.billing_code_id);if(isNaN(n)||n<=0)throw new Error("Invalid billing code ID");s.set("billing_code_id",n.toString());const a=e=>{const[t,r]=e.split("T"),[i,s]=r.split(":");return`${t}T${i}:${s}`};s.set("start",a(e.start)),s.set("end",a(e.end)),s.set("notes",e.notes||""),s.set("is_meeting",e.is_meeting?"true":"false"),e.impersonate_as_user_id&&s.set("impersonate_as_user_id",e.impersonate_as_user_id.toString());try{const e="/api/entries/0",t={"Content-Type":"application/x-www-form-urlencoded","x-access-token":localStorage.getItem("snowpack_token")};return(await r.post(e,s.toString(),{headers:t})).data}catch(o){throw console.error("Failed to create timesheet entry:",o),o}},async updateEntry(e){const t=Number(e.entry_id);if(!t||isNaN(t)||t<=0)throw new Error(`Invalid entry ID for update: ${e.entry_id}`);const s=i(e);if(!s.isValid)throw new Error(`Validation failed: ${s.errors.join(", ")}`);const n=new URLSearchParams,a=Number(e.billing_code_id);if(isNaN(a)||a<=0)throw new Error("Invalid billing code ID");n.set("billing_code_id",a.toString());const o=e=>{const[t,r]=e.split("T"),[i,s]=r.split(":");return`${t}T${i}:${s}`};if(n.set("start",o(e.start)),n.set("end",o(e.end)),n.set("notes",e.notes||""),n.set("is_meeting",e.is_meeting?"true":"false"),e.impersonate_as_user_id){const t=Number(e.impersonate_as_user_id);n.set("impersonate_as_user_id",t.toString())}else n.set("impersonate_as_user_id","0");try{const e=`/api/entries/${t}`,i={"Content-Type":"application/x-www-form-urlencoded","x-access-token":localStorage.getItem("snowpack_token")};return(await r.put(e,n.toString(),{headers:i})).data}catch(d){throw console.error(`Failed to update timesheet entry ${t}:`,d),d}},async deleteEntry(e){try{return t("entries",e)}catch(r){throw console.error("Failed to delete timesheet entry:",r),r}}},n=s.getEntries,a=s.getUsers,o=s.getActiveBillingCodes,d=s.createEntry,l=s.updateEntry,c=s.deleteEntry;export{o as a,a as b,d as c,c as d,n as g,l as u};
