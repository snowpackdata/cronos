import{h as e,r as t,b as s,f as a,c as l,a as r,q as n,H as o,I as i,J as c,F as x,G as u,z as d,A as p,x as y,E as m,o as f}from"./index-2uCPEpPG.js";import{f as E}from"./projects-QDzbZapS.js";import{g,a as v,r as b}from"./expenses-2oe5Yinl.js";import{_ as h}from"./StaffAvatar.vue_vue_type_script_setup_true_lang-ChSVjzSa.js";import"./index-8V-xrl-L.js";const w={class:"max-w-7xl mx-auto px-3 py-2"},T={class:"bg-white shadow rounded p-2 mb-2"},_={class:"flex gap-2 items-end"},S={class:"flex-1"},k={class:"flex-1"},A={class:"bg-white shadow rounded overflow-hidden"},P={key:0,class:"p-4 text-center text-xs text-gray-500"},D={key:1,class:"p-4 text-center text-xs text-gray-500"},j={key:2,class:"min-w-full divide-y divide-gray-200"},R={class:"bg-white divide-y divide-gray-200"},C={class:"px-2 py-1 text-xs text-gray-900"},N={class:"px-2 py-1"},X={class:"flex items-center gap-2"},I={class:"text-xs text-gray-900"},U={class:"px-2 py-1 text-xs text-gray-600"},V={class:"px-2 py-1 text-xs text-gray-600"},F={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},O={key:1,class:"text-gray-400"},$={class:"px-2 py-1 text-xs"},L={key:0,class:"flex flex-wrap gap-1"},B={key:1,class:"text-gray-400"},M={class:"px-2 py-1 text-xs text-gray-900"},J={class:"px-2 py-1 text-right text-xs text-gray-900"},z={class:"px-2 py-1 text-center"},q=["onClick"],H={key:1,class:"text-xs text-gray-400"},G={class:"px-2 py-1 text-center"},K={class:"px-2 py-1 text-center"},Q={class:"flex items-center justify-center gap-1"},W=["onClick"],Y=["onClick"],Z={key:2,class:"text-xs text-gray-600"},ee=["title"],te={key:4,class:"text-xs text-gray-400"},se={key:0,class:"fixed inset-0 z-10 w-screen overflow-y-auto"},ae={class:"flex min-h-full items-center justify-center p-4 text-center sm:p-0"},le={class:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-6 sm:w-full sm:max-w-md"},re={class:"bg-white px-3 py-4 sm:p-6"},ne={class:"mb-3"},oe={key:0,class:"mb-3 p-2 bg-red-50 border border-red-200 text-red-700 text-2xs rounded"},ie={class:"flex flex-row-reverse"},ce=["disabled"],xe=e({__name:"ExpenseApprovalView",setup(e){const xe=t([]),ue=t([]),de=t(!1),pe=t(""),ye=t({status:""}),me=t(!1),fe=t(null),Ee=t(""),ge=t(!1),ve=t(null),be=s(()=>{let e=xe.value;if(pe.value){const t=pe.value.toLowerCase();e=e.filter(e=>we(e).toLowerCase().includes(t))}return e});function he(e){const t=ue.value.find(t=>t.ID===e);return t?t.name:"-"}function we(e){return e.submitter?`${e.submitter.first_name} ${e.submitter.last_name}`:"-"}function Te(e){return e.approver?`${e.approver.first_name} ${e.approver.last_name}`:"-"}function _e(e){switch(e){case"EXPENSE_STATE_DRAFT":return"Draft";case"EXPENSE_STATE_SUBMITTED":return"Submitted";case"EXPENSE_STATE_APPROVED":return"Approved";case"EXPENSE_STATE_REJECTED":return"Rejected";case"EXPENSE_STATE_INVOICED":return"Invoiced";case"EXPENSE_STATE_PAID":return"Paid";default:return e}}function Se(e){switch(e){case"EXPENSE_STATE_DRAFT":default:return"bg-gray-100 text-gray-800";case"EXPENSE_STATE_SUBMITTED":return"bg-yellow-100 text-yellow-800";case"EXPENSE_STATE_APPROVED":return"bg-green-100 text-green-800";case"EXPENSE_STATE_REJECTED":return"bg-red-100 text-red-800";case"EXPENSE_STATE_INVOICED":return"bg-blue-100 text-blue-800";case"EXPENSE_STATE_PAID":return"bg-purple-100 text-purple-800"}}async function ke(){de.value=!0;try{const e={};ye.value.status&&(e.status=ye.value.status),xe.value=await g(e)}catch(e){console.error("Failed to fetch expenses:",e),xe.value=[]}finally{de.value=!1}}function Ae(){me.value=!1,fe.value=null,Ee.value="",ve.value=null}async function Pe(){if(fe.value&&Ee.value){ge.value=!0,ve.value=null;try{await b(fe.value,Ee.value),await ke(),Ae()}catch(e){ve.value=e.message||"Failed to reject expense"}finally{ge.value=!1}}}return a(async()=>{await async function(){try{const e=await E();ue.value=e}catch(e){console.error("Failed to fetch projects:",e),ue.value=[]}}(),await ke()}),(e,t)=>(f(),l("div",w,[t[17]||(t[17]=r("div",{class:"mb-2 flex justify-between items-center"},[r("div",null,[r("h1",{class:"text-lg font-bold text-gray-900"},"Expense Approvals"),r("p",{class:"text-xs text-gray-500"}," Review and approve submitted expenses ")])],-1)),r("div",T,[r("div",_,[r("div",S,[t[4]||(t[4]=r("label",{class:"block text-xs font-medium text-gray-700 mb-0.5"},"Status",-1)),o(r("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>ye.value.status=e),onChange:ke,class:"block w-full rounded border-gray-300 text-xs py-1"},t[3]||(t[3]=[r("option",{value:""},"All Statuses",-1),r("option",{value:"EXPENSE_STATE_SUBMITTED"},"Pending Approval",-1),r("option",{value:"EXPENSE_STATE_APPROVED"},"Approved",-1),r("option",{value:"EXPENSE_STATE_REJECTED"},"Rejected",-1)]),544),[[i,ye.value.status]])]),r("div",k,[t[5]||(t[5]=r("label",{class:"block text-xs font-medium text-gray-700 mb-0.5"},"Search",-1)),o(r("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>pe.value=e),type:"text",placeholder:"Search expenses...",class:"block w-full rounded border-gray-300 text-xs py-1"},null,512),[[c,pe.value]])])])]),r("div",A,[de.value?(f(),l("div",P," Loading... ")):0===be.value.length?(f(),l("div",D," No expenses found ")):(f(),l("table",j,[t[11]||(t[11]=r("thead",{class:"bg-gray-50"},[r("tr",null,[r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Date"),r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Submitter"),r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Project"),r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Category"),r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Tags"),r("th",{class:"px-2 py-1 text-left text-xs font-medium text-gray-500 uppercase"},"Description"),r("th",{class:"px-2 py-1 text-right text-xs font-medium text-gray-500 uppercase"},"Amount"),r("th",{class:"px-2 py-1 text-center text-xs font-medium text-gray-500 uppercase"},"Receipt"),r("th",{class:"px-2 py-1 text-center text-xs font-medium text-gray-500 uppercase"},"Status"),r("th",{class:"px-2 py-1 text-center text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),r("tbody",R,[(f(!0),l(x,null,u(be.value,e=>{return f(),l("tr",{key:e.ID,class:"hover:bg-sage-pale hover:bg-opacity-30 transition-colors"},[r("td",C,d((a=e.date,new Date(a).toLocaleDateString())),1),r("td",N,[r("div",X,[e.submitter?(f(),p(h,{key:0,employee:e.submitter,size:"xs"},null,8,["employee"])):n("",!0),r("span",I,d(we(e)),1)])]),r("td",U,d(he(e.project_id)),1),r("td",V,[e.category?(f(),l("span",F,d(e.category.name),1)):(f(),l("span",O,"-"))]),r("td",$,[e.tags&&e.tags.length>0?(f(),l("div",L,[(f(!0),l(x,null,u(e.tags,e=>(f(),l("span",{key:e.ID,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},d(e.name),1))),128))])):(f(),l("span",B,"-"))]),r("td",M,d(e.description),1),r("td",J,d((s=e.amount,`$${(s/100).toFixed(2)}`)),1),r("td",z,[e.receipt_id?(f(),l("button",{key:0,onClick:t=>async function(e){try{const t=xe.value.find(t=>t.receipt_id===e);if(!(null==t?void 0:t.receipt))return void console.error("Receipt not found");const s=`/api/assets/${e}/download`,a=localStorage.getItem("snowpack_token"),l=await fetch(s,{headers:{"x-access-token":a||""}});if(!l.ok)throw new Error(`Download failed: ${l.statusText}`);const r=await l.blob(),n=window.URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=t.receipt.name||`receipt_${e}`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)}catch(t){console.error("Failed to view receipt:",t)}}(e.receipt_id),class:"inline-flex items-center justify-center w-7 h-7 text-white bg-sage hover:bg-sage-dark rounded shadow-sm transition-colors",title:"View receipt"},t[6]||(t[6]=[r("i",{class:"fa fa-receipt text-xs"},null,-1)]),8,q)):(f(),l("span",H,"-"))]),r("td",G,[r("span",{class:y([Se(e.state),"px-1.5 py-0.5 text-xs font-semibold rounded"])},d(_e(e.state)),3)]),r("td",K,[r("div",Q,["EXPENSE_STATE_SUBMITTED"===e.state?(f(),l("button",{key:0,onClick:t=>async function(e){try{await v(e),await ke()}catch(t){console.error("Failed to approve expense:",t)}}(e.ID),class:"inline-flex items-center justify-center w-7 h-7 text-white bg-sage hover:bg-sage-dark rounded shadow-sm transition-colors",title:"Approve expense"},t[7]||(t[7]=[r("i",{class:"fa fa-check text-xs"},null,-1)]),8,W)):n("",!0),"EXPENSE_STATE_SUBMITTED"===e.state?(f(),l("button",{key:1,onClick:t=>{return s=e.ID,fe.value=s,Ee.value="",ve.value=null,void(me.value=!0);var s},class:"inline-flex items-center justify-center w-7 h-7 text-white bg-red-600 hover:bg-red-500 rounded shadow-sm transition-colors",title:"Reject expense"},t[8]||(t[8]=[r("i",{class:"fa fa-times text-xs"},null,-1)]),8,Y)):n("",!0),"EXPENSE_STATE_APPROVED"===e.state?(f(),l("span",Z,[t[9]||(t[9]=r("i",{class:"fa fa-check-circle text-sage mr-1"},null,-1)),m(" "+d(Te(e)),1)])):n("",!0),"EXPENSE_STATE_REJECTED"===e.state?(f(),l("span",{key:3,class:"text-xs text-gray-600 cursor-help",title:e.rejection_reason},t[10]||(t[10]=[r("i",{class:"fa fa-times-circle text-red-600 mr-1"},null,-1),m(" Rejected ")]),8,ee)):n("",!0),"EXPENSE_STATE_SUBMITTED"!==e.state&&"EXPENSE_STATE_APPROVED"!==e.state&&"EXPENSE_STATE_REJECTED"!==e.state?(f(),l("span",te,"-")):n("",!0)])])]);var s,a}),128))])]))]),me.value?(f(),l("div",se,[r("div",ae,[r("div",{class:"fixed inset-0 bg-gray-500/75 transition-opacity",onClick:Ae}),r("div",le,[r("div",{class:"bg-red-600 text-white px-4 py-2 sm:px-4 sm:py-2 flex justify-between items-center"},[t[13]||(t[13]=r("h3",{class:"text-base font-semibold leading-6"}," Reject Expense ",-1)),r("button",{onClick:Ae,type:"button",class:"text-white hover:text-gray-200 focus:outline-none"},t[12]||(t[12]=[r("i",{class:"fa fa-times h-5 w-5"},null,-1)]))]),r("div",re,[r("div",ne,[t[14]||(t[14]=r("label",{class:"block text-2xs font-medium text-gray-700"},[m(" Reason for Rejection "),r("span",{class:"text-gray-400"},"(required)")],-1)),o(r("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>Ee.value=e),rows:"4",class:"mt-0.5 bg-white border border-gray-300 text-gray-900 text-2xs rounded focus:ring-red-500 focus:border-red-500 block w-full p-1",placeholder:"Explain why this expense is being rejected...",autofocus:""},null,512),[[c,Ee.value]])]),ve.value?(f(),l("div",oe,d(ve.value),1)):n("",!0),r("div",ie,[r("button",{onClick:Pe,type:"button",disabled:!Ee.value||ge.value,class:"inline-flex justify-center rounded bg-red-600 px-2.5 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-2 sm:w-auto"},[ge.value?(f(),l(x,{key:0},[t[15]||(t[15]=r("svg",{class:"animate-spin -ml-1 mr-2 h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t[16]||(t[16]=m(" Rejecting... "))],64)):(f(),l(x,{key:1},[m(" Reject ")],64))],8,ce),r("button",{onClick:Ae,type:"button",class:"mt-2 inline-flex justify-center rounded bg-white px-2.5 py-1 text-xs font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"}," Cancel ")])])])])])):n("",!0)]))}});export{xe as default};
